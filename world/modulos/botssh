#!/bin/bash
clear
#--------@DONOMODDERAJUDA-----------#
source ShellBot.sh
touch lista
[[ -z $1 ]] && {
    clear && echo "INFORME O TOKEN" && return 0
}
[[ ! -e RESET ]] && touch RESET
api_bot=$1
ShellBot.init --token "$api_bot" --monitor --flush
ShellBot.username

# - Funcao menu
menu() {
    local msg
        msg="=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=\n"
        msg+="<b>ü§ñ SEJA BEM VINDO(A) A ROS√ÅRIO NET! ü§ñ</b>\n"
        msg+="=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=\n\n\n"
        msg+="<b>DICA: PARA GERAR LOGIN DE TESTE CLIQUE NO BOT√ÉO (GERAR TESTE GR√ÅTIS)</b>\n\n\nVOC√ä PODER√Å GERAR UM LOGIN A CADA 24HRS \n"
        msg+="=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=\n\n"
        msg+="<b>√â PROIBIDO O USO DE TORRENT, AO SER FLAGRADO USANDO TORRENT, O SEU LOGIN SER√Å CANCELADO!</b>\n"
        msg+="=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=\n\n"
        msg+="<b>COMPRE SEU LOGIN MENSAL POR APENAS 15$, CLIQUE NO BOT√ÉO (COMPRAR LOGIN MENSAL)</b>\n"
        msg+="=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=\n\n"
        msg+="<b>AJUDE-NOS A CONTINUAR COM ESTE PROJETO (FAZ O PIX) ‚ù§Ô∏è</b>\n"
        msg+="=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó=√ó="
        ShellBot.sendMessage --chat_id ${message_chat_id[$id]} \
        --text "$(echo -e $msg)" \
        --reply_markup "$keyboard1" \
        --parse_mode html
        return 0
}

# - funcao criar ssh
criarteste() {
    [[ $(grep -wc ${callback_query_from_id} lista) != '0' ]] && {
      ShellBot.sendMessage --chat_id ${callback_query_message_chat_id} \
        --text "VC JA CRIOU LOGIN HOJE, VOLTE EM 24HRS !"
      return 0
    }
    usuario=$(echo teste$(( RANDOM% + 9999 + 1111 )))
    senha=$((RANDOM% + 99999))
    limite='2'
    dias='2'
    tuserdate=$(date '+%C%y/%m/%d' -d " +2 days")
    useradd -M -N -s /bin/false $usuario -e $tuserdate > /dev/null 2>&1
    (echo "$senha";echo "$senha") | passwd $usuario > /dev/null 2>&1
    echo "$senha" > /etc/SSHPlus/senha/$usuario
    echo "$usuario $limite" >> /root/usuarios.db
    echo "#!/bin/bash
pkill -f "$usuario"
userdel --force $usuario
grep -v ^$usuario[[:space:]] /root/usuarios.db > /tmp/ph ; cat /tmp/ph > /root/usuarios.db
rm /etc/SSHPlus/senha/$usuario > /dev/null 2>&1
rm -rf /etc/SSHPlus/userteste/$usuario.sh" > /etc/SSHPlus/userteste/$usuario.sh
    chmod +x /etc/SSHPlus/userteste/$usuario.sh
    at -f /etc/SSHPlus/userteste/$usuario.sh now + $dias hour > /dev/null 2>&1
    echo ${callback_query_from_id} >> lista
    # - ENVIA O SSH
    ShellBot.sendMessage --chat_id ${callback_query_message_chat_id} \
    --text "$(echo -e "‚úÖ ü§©<b>LOGIN CRIADO</b>ü§© \r\n‚ùó<b>SALVE O SEU LOGIN</b>‚ùó \r\n\r\nüöª<b>USU√ÅRIO:</b> <code>$usuario</code>\r\nüîê<b>SENHA:</b> <code>$senha</code>\r\n‚ùå<b>LIMITE:</b> 1\r\n<b>‚è∞VALIDADE:</b> $dias Dias \r\n\r\n<b>BAIXE O APLICATIVO MAIS RECENTE NO NOSSO BOT E FIQUE POR DENTRO DAS NOVIDADES</b>\r\n<b>ACESSE O NOSSO BOT</b> @ajudarosarionetbot\r\n<b>ACESSE O NOSSO GRUPO</b> @cursosshvpn")" \
    --parse_mode html
    return 0
}

#comprarmensal
buylogin() {
    ShellBot.answerCallbackQuery --callback_query_id ${callback_query_id[$id]} \
        --text "‚ôªÔ∏è AGUARDE..."
    ShellBot.sendMessage --chat_id ${callback_query_message_chat_id} \
    --text "$(echo -e "‚úÖ üòç<b>MUITO OBRIGADO POR CONFIAR EM MEU TRABALHO</b>üòç\r\n<b>FA√áA O PIX DE 15$ REAIS E ENVIE O COMPROVANTE PARA</b>üëâ @jailondanet üëà\r\n<b>üëá CHAVE PIX üëá</b>\r\n<code>anjaylom@gmail.com</code> ")" \
    --parse_mode html
    return 0
}

#enviar app
enviarapp() {
    ShellBot.answerCallbackQuery --callback_query_id ${callback_query_id[$id]} \
        --text "‚ôªÔ∏è ENVIANDO APLICATIVO, AGUARDE..."
    ShellBot.sendDocument --chat_id ${callback_query_message_chat_id} \
        --document "@/root/app.apk" \
    return 0
}
    
#comprar o mod
buymod() {
    ShellBot.answerCallbackQuery --callback_query_id ${callback_query_id[$id]} \
        --text "‚ôªÔ∏è AGUARDE..."
    ShellBot.sendMessage --chat_id ${callback_query_message_chat_id} \
    --text "$(echo -e "‚úÖ üòç<b>COMPRE MODS DO CONECTA4G E OUTROS POR UM PRE√áO ACESS√çVEL, MODS LINDOS E LEVES</b>üòç\r\n<b>CHAMA L√Å PRA N√ìS TROCAR UMA ID√âIA</b>üëâ @jailondanet\r\n<b>CONFIGURO SEU SERVIDOR VPS, CHAMA</b>üëâ @jailondanet")" \
    --parse_mode html
    return 0
}

#fazer pix
obapix() {
    ShellBot.answerCallbackQuery --callback_query_id ${callback_query_id[$id]} \
        --text "‚ôªÔ∏è AGUARDE..."
    ShellBot.sendMessage --chat_id ${callback_query_message_chat_id} \
    --text "$(echo -e "‚úÖ üòç<b>AGRADE√áO IMENSAMENTE PELO SEU GRANDE FEITO,</b>üòç\r\n<b>MUITO OBRIGADO POR CONFIAR EM MEU TRABALHO</b>üòç\r\n<b>üëá CHAVE PIX üëá</b>\r\n<code>anjaylom@gmail.com</code> ")" \
    --parse_mode html
    return 0
}

#informacoes usuario
infouser () {
	ShellBot.sendMessage --chat_id ${message_chat_id[$id]} \
	--text "$(echo -e "Nome:  ${message_from_first_name[$(ShellBot.ListUpdates)]}\nUser: @${message_from_username[$(ShellBot.ListUpdates)]:-null}")\nID: ${message_from_id[$(ShellBot.ListUpdates)]} " \
	--parse_mode html
	return 0
}

unset botao1
botao1=''
ShellBot.InlineKeyboardButton --button 'botao1' --line 1 --text '‚ôªÔ∏è GERAR TESTE GR√ÅTIS‚ôªÔ∏è' --callback_data 'gerarssh'
ShellBot.InlineKeyboardButton --button 'botao1' --line 3 --text '‚ù§Ô∏èÔ∏è COMPRAR LOGIN MENSAL ‚ù§Ô∏èÔ∏è' --callback_data 'buymensal'
ShellBot.InlineKeyboardButton --button 'botao1' --line 5 --text 'üî∞ BAIXAR APLICATIVO üî∞' --callback_data 'appenviar'
ShellBot.InlineKeyboardButton --button 'botao1' --line 7 --text 'üíµ COMPRAR MOD CONECTA4G ou OUTROS üíµ' --callback_data 'comprarmod'
ShellBot.InlineKeyboardButton --button 'botao1' --line 9 --text 'ü§û APOIAR PROJETO üôèÔ∏è' --callback_data 'fazerpix'
ShellBot.regHandleFunction --function criarteste --callback_data gerarssh
ShellBot.regHandleFunction --function buylogin --callback_data buymensal
ShellBot.regHandleFunction --function enviarapp --callback_data appenviar
ShellBot.regHandleFunction --function buymod --callback_data comprarmod
ShellBot.regHandleFunction --function obapix --callback_data fazerpix
unset keyboard1
keyboard1="$(ShellBot.InlineKeyboardMarkup -b 'botao1')"
while :; do
   [[ "$(date +%d)" != "$(cat RESET)" ]] && {
   	echo $(date +%d) > RESET
   	echo ' ' > lista
   }
  ShellBot.getUpdates --limit 100 --offset $(ShellBot.OffsetNext) --timeout 24
  for id in $(ShellBot.ListUpdates); do
    (
      ShellBot.watchHandle --callback_data ${callback_query_data[$id]}
      comando=(${message_text[$id]})
      [[ "${comando[0]}" = "/menu"  || "${comando[0]}" = "/start" ]] && menu
      [[ "${comando[0]}" = "/id"  ]] && infouser
    ) &
  done
done
